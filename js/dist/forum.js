(()=>{var t={n:o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return t.d(a,{a}),a},d:(o,a)=>{for(var e in a)t.o(a,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:a[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o),t.d(o,{default:()=>ot});const a=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/components/IndexPage"];var s=t.n(e);const r=flarum.core.compat["common/components/LinkButton"];var n=t.n(r);const i=flarum.core.compat["common/Model"];var c=t.n(i);const l=flarum.core.compat["tags/models/Tag"];var u=t.n(l);function d(t,o){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},d(t,o)}function g(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,d(t,o)}const p=flarum.core.compat["forum/app"];var f=t.n(p);const h=flarum.core.compat["common/components/Page"];var v=t.n(h);const y=flarum.core.compat["common/components/LoadingIndicator"];var C=t.n(y);const b=flarum.core.compat["forum/components/AffixedSidebar"];var w=t.n(b);const T=flarum.core.compat["common/helpers/listItems"];var N=t.n(T);const I=flarum.core.compat["common/utils/ItemList"];var k=t.n(I);const P=flarum.core.compat["common/utils/extractText"];var L=t.n(P);const D=flarum.core.compat["common/utils/classList"];var A=t.n(D);const M=flarum.core.compat["tags/utils/sortTags"];var _=t.n(M);const x=flarum.core.compat["tags/helpers/tagLabel"];var S=t.n(x);const O=flarum.core.compat["common/Component"];var U=t.n(O);const B=flarum.core.compat["common/components/Link"];var j=t.n(B);const W=flarum.core.compat["common/helpers/icon"];var R=t.n(W),V=function(t){function o(){return t.apply(this,arguments)||this}g(o,t);var a=o.prototype;return a.view=function(){return m("div",{class:A()("StatWidget",{"Categories-compactMobileModeEnabled":!!f().forum.attribute("categories.compactMobile")})},this.content().toArray())},a.content=function(){var t=new(k());return t.add("count",m("div",{class:"StatWidget-count"},this.attrs.count),100),t.add("label",m("div",{class:"StatWidget-label"},m("span",{className:"Categories-showOnMobile"},R()(this.attrs.icon)),m("span",{className:"Categories-hideOnMobile"},this.attrs.label)),80),t},o}(U());const z=flarum.core.compat["common/helpers/avatar"];var E=t.n(z);const F=flarum.core.compat["common/helpers/username"];var q=t.n(F);const G=flarum.core.compat["common/helpers/humanTime"];var H=t.n(G);const J=flarum.core.compat["common/utils/string"],K=flarum.core.compat["forum/components/UserCard"];var Q=t.n(K),X=function(t){function o(){for(var o,a=arguments.length,e=new Array(a),s=0;s<a;s++)e[s]=arguments[s];return(o=t.call.apply(t,[this].concat(e))||this).cardVisible=void 0,o}g(o,t);var a=o.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o),this.cardVisible=!1},a.view=function(){var t,o=this.attrs.discussion;return o?(o.lastPostedUser(),m(j(),{class:"LastDiscussion",href:f().route.discussion(o,null!=(t=o.lastPostNumber())?t:0)},this.content().toArray())):m("div",{class:"LastDiscussion"},f().translator.trans("askvortsov-categories.forum.last_discussion_widget.no_discussions"))},a.content=function(){var t=new(k()),o=this.attrs.discussion,a=o.lastPostedUser();t.add("avatar",m(j(),{className:"LastDiscussion-avatar",href:a?f().route.user(a):"#","aria-label":L()(q()(a))},!!a&&E()(a)),100),t.add("mainContent",m("div",{class:"LastDiscussion-content"},m("div",{class:"LastDiscussion-topRow"},(0,J.truncate)(o.title(),26)),m("div",{class:"LastDiscussion-bottomRow"},H()(o.lastPostedAt())," ",m(j(),{className:"LastDiscussion-usernameLink",href:a?f().route.user(a):"#"},m("span",{style:{display:"inline",margin:"0 4px"},role:"presentation"},"|"),q()(a)))),50);var e=null;return a&&this.cardVisible&&(e=Q().component({user:a,className:"UserCard--popover",controlsButtonClassName:"Button Button--icon Button--flat"})),t.add("card",m("div",{class:"LastDiscussion-userCardContainer"},e),10),t},a.oncreate=function(o){var a,e=this;t.prototype.oncreate.call(this,o),this.$().on("mouseover",".LastDiscussion-avatar, .LastDiscussion-usernameLinkUserCard, .username, .UserCard",(function(){clearTimeout(a),a=window.setTimeout(e.showCard.bind(e),300)})).on("mouseout",".LastDiscussion-avatar, .LastDiscussion-usernameLinkUserCard, .username, .UserCard",(function(){clearTimeout(a),a=window.setTimeout(e.hideCard.bind(e),150)}))},a.onremove=function(o){t.prototype.onremove.call(this,o),this.$().off("mouseover mouseout")},a.showCard=function(){var t=this;this.cardVisible=!0,m.redraw(),setTimeout((function(){return t.$(".UserCard").addClass("in")}))},a.hideCard=function(){$(".UserCard").removeClass("in"),this.cardVisible=!1,m.redraw()},o}(U()),Y=function(t){function o(){for(var o,a=arguments.length,e=new Array(a),s=0;s<a;s++)e[s]=arguments[s];return(o=t.call.apply(t,[this].concat(e))||this).tag=void 0,o.isChild=void 0,o.collapsed=void 0,o.compactMobileMode=void 0,o}g(o,t);var a=o.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o),this.tag=this.attrs.model,this.isChild=null!=this.attrs.parent&&null!=this.attrs.parent,this.collapsed=!1,window.addEventListener("resize",(function(){m.redraw()}))},a.view=function(){var t=this.tag;return t?(this.compactMobileMode=!!f().forum.attribute("categories.compactMobile"),m("li",{className:A()("TagCategory","TagCategory-"+t.slug(),{SubCategory:this.isChild,ParentCategory:!this.isChild,compactMobile:this.compactMobileMode})},this.categoryItems().toArray())):null},a.categoryItems=function(){var t=this,a=new(k()),e=this.tag,s=this.isChild?[]:_()(e.children()||[]);return a.add("link",m(j(),{className:"TagCategory-content TagCategory-content-"+e.slug(),style:this.isChild?{}:{backgroundColor:e.color()},href:f().route.tag(e)},this.contentItems().toArray()),100),this.compactMobileMode||this.isChild||a.add("children",m("ol",{className:"TagCategory-subTagList"},s.map((function(a){return[o.component({model:a,parent:t})]}))),10),a},a.contentItems=function(){var t=this,a=new(k()),e=this.tag,s=this.isChild?[]:_()(e.children()||[]);a.add("top",m("div",{className:"TagCategory-top"},this.topItems().toArray()),100);var r=!this.isChild&&this.compactMobileMode;return s.length&&a.add("toggleArrow",m("button",{className:"TagCategory-toggleArrow Button--ua-reset",onclick:function(o){t.toggleArrow(o)}},R()(this.collapsed?"fas fa-caret-down":"fas fa-caret-up")),10),r&&!this.collapsed&&a.add("children",m("ol",{className:"TagCategory-subTagList"},s.map((function(a){return[o.component({model:a,parent:t})]}))),10),a},a.topItems=function(){var t=new(k()),o=this.tag;return this.isChild||_()(o.children()||[]),t.add("identity",m("div",{class:"TagCategory-identity"},m("span",{className:"TagCategory-icon"},this.iconItems().toArray()),m("div",{className:"TagCategory-name"},this.nameItems().toArray())),100),t.add("stats",m("div",{className:"TagCategory-stats StatWidgetList"},this.statItems().toArray()),50),t.add("lastDiscussion",m("div",{className:A()("TagCategory-lastDiscussion",{empty:!o.lastPostedDiscussion()})},this.lastDiscussionItems().toArray()),50),t},a.iconItems=function(){var t=new(k());if(this.tag.icon()&&this.isChild){var o={},a="fa-stack-1x CategoryIcon";f().forum.attribute("categories.childBareIcon")&&(o.color=this.tag.color(),a+=" NoBackgroundCategoryIcon");var e=this.compactMobileMode?"fa-stack fa-1x":"fa-stack fa-2x";t.add("icon",m("span",{className:e},!!f().forum.attribute("categories.childBareIcon")&&m("i",{className:"fa fa-circle fa-stack-2x icon-background",style:{color:this.tag.color()}}),R()(this.tag.icon(),{className:a,style:o})),10)}else if(this.tag.icon()&&!f().forum.attribute("categories.parentRemoveIcon")){var s=this.compactMobileMode?"fa-stack fa-2x":"fa-stack fa-3x";t.add("icon",m("span",{className:s},R()(this.tag.icon(),{className:"fa-stack-1x CategoryIcon"})),10)}return t},a.nameItems=function(){var t=new(k());return t.add("name",m("h4",{className:"TagCategory-name"},this.tag.name()),15),t},a.statItems=function(){var t=new(k());return!this.isChild&&f().forum.attribute("categories.parentRemoveStats")||(t.add("discussionCount",V.component({count:Intl.NumberFormat().format(this.tag.discussionCount()),label:f().translator.trans("askvortsov-categories.forum.stat-widgets.discussion_label"),icon:"fas fa-file-alt"}),15),t.add("postCount",V.component({count:Intl.NumberFormat().format(this.tag.postCount()),label:f().translator.trans("askvortsov-categories.forum.stat-widgets.post_label"),icon:"fas fa-comment"}),10)),t},a.lastDiscussionItems=function(){var t=new(k());return!this.isChild&&f().forum.attribute("categories.parentRemoveLastDiscussion")||t.add("lastDiscussion",X.component({discussion:this.tag.lastPostedDiscussion()}),10),t},a.oncreate=function(o){t.prototype.oncreate.call(this,o),this.$(".TagCategory-content,.TagCategory-toggleArrow").on("mouseenter",(function(t){$(this).addClass("hover"),($(this).parent().hasClass("SubCategory")||$(this).hasClass("TagCategory-toggleArrow"))&&$(this).closest(".ParentCategory").children(".TagCategory-content").removeClass("hover")})),this.$(".TagCategory-content,.TagCategory-toggleArrow").on("mouseleave",(function(t){$(this).removeClass("hover"),($(this).parent().hasClass("SubCategory")||$(this).hasClass("TagCategory-toggleArrow"))&&$(this).closest(".ParentCategory").children(".TagCategory-content").addClass("hover")}))},a.onremove=function(o){t.prototype.onremove.call(this,o),this.$(".TagCategory-content,.TagCategory-toggleArrow").off("mouseenter"),this.$(".TagCategory-content,.TagCategory-toggleArrow").off("mouseleave")},a.toggleArrow=function(t){t.preventDefault(),t.stopPropagation(),this.collapsed=!this.collapsed,m.redraw()},o}(U()),Z=function(t){function o(){for(var o,a=arguments.length,e=new Array(a),s=0;s<a;s++)e[s]=arguments[s];return(o=t.call.apply(t,[this].concat(e))||this).tags=void 0,o.loading=void 0,o}g(o,t);var a=o.prototype;return a.oninit=function(o){var a=this;t.prototype.oninit.call(this,o),f().history.push("categories",L()(f().translator.trans("askvortsov-category.forum.header.back_to_categories_tooltip"))),this.tags=[];var e=f().preloadedApiDocument();e?this.tags=_()(e.filter((function(t){return!t.isChild()}))):(this.loading=!0,f().tagList.load(["parent","children","lastPostedDiscussion","lastPostedDiscussion.lastPostedUser"]).then((function(){a.tags=_()(f().store.all("tags").filter((function(t){return!t.isChild()}))),a.loading=!1,m.redraw()})))},a.view=function(){if(this.loading)return m(C(),null);var t=f().forum.attribute("categories.fullPageDesktop")?["CategoriesPage","TagsPage"]:["CategoriesPage"];return m("div",{className:A()(t)},this.pageItems().toArray())},a.pageItems=function(){var t=new(k());return t.add("hero",s().prototype.hero(),100),t.add("container",m("div",{className:"container"},m("div",{className:f().forum.attribute("categories.fullPageDesktop")?"":"sideNavContainer"},this.containerItems().toArray())),50),t},a.containerItems=function(){var t=new(k()),o=this.tags.filter((function(t){return null!==t.position()})),a=this.tags.filter((function(t){return null===t.position()}));return t.add("sideNav",m(w(),null,m("nav",{className:"CategoriesPage-nav TagsPage-nav IndexPage-nav sideNav"},m("ul",null,N()(s().prototype.sidebarItems().toArray())))),100),t.add("categoriesList",m("div",{className:"CategoriesPage-content sideNavOffset"},a.length?m("div",{className:"TagCloud"},a.map((function(t){return[S()(t,{link:!0})," "]}))):"",m("ol",{className:"TagCategoryList"},o.map((function(t){return Y.component({model:t})})))),50),t},a.oncreate=function(o){t.prototype.oncreate.call(this,o),f().setTitle(L()(f().translator.trans("askvortsov-categories.forum.all_categories.meta_title_text")))},o}(v());function tt(t,o){if(app.current.matches(Z)&&app.forum.attribute("categories.fullPageDesktop"))for(var a in t.items)o(a)&&t.remove(a)}app.initializers.add("askvortsov/flarum-categories",(function(){app.routes.categories={path:"/categories",component:Z},u().prototype.postCount=c().attribute("postCount"),(0,a.extend)(s().prototype,"navItems",(function(t){return t.has("tags")&&!app.forum.attribute("categories.keepTagsNav")&&t.remove("tags"),t.add("categories",m(n(),{icon:"fas fa-th-list",href:app.route("categories")},app.translator.trans("askvortsov-categories.forum.index.categories_link")),-9.5),t.has("moreTags")&&t.replace("moreTags",m(n(),{href:app.route("categories")},app.translator.trans("flarum-tags.forum.index.more_link"))),tt(t,(function(t){return t.startsWith("tag")})),t})),(0,a.extend)(s().prototype,"sidebarItems",(function(t){return tt(t,(function(t){return"newDiscussion"!==t&&"nav"!==t})),t}))}));const ot={"components/CategoriesPage":Z,"components/Category":Y,"components/LastDiscussionWidget":X,"components/StatWidget":V}})(),module.exports=o})();
//# sourceMappingURL=forum.js.map